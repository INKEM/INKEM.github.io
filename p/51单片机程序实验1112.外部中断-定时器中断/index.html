<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="程序实验11&amp;12.外部中断-定时器中断 中断系统 中断概念 中断是为使单片机具有对外部或内部随机发生的事件实时处理而设置的，中断功能的存在很大程度上提高了单片机处理外部或内部事件的能力。引起程序中断的根源称为中断源。\n">
<title>【51单片机】程序实验11&amp;12.外部中断-定时器中断</title>

<link rel='canonical' href='https://INKEM.github.io/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="【51单片机】程序实验11&12.外部中断-定时器中断">
<meta property='og:description' content="程序实验11&amp;12.外部中断-定时器中断 中断系统 中断概念 中断是为使单片机具有对外部或内部随机发生的事件实时处理而设置的，中断功能的存在很大程度上提高了单片机处理外部或内部事件的能力。引起程序中断的根源称为中断源。\n">
<meta property='og:url' content='https://INKEM.github.io/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/'>
<meta property='og:site_name' content='一杯为品'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2024-12-04T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2024-12-04T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="【51单片机】程序实验11&12.外部中断-定时器中断">
<meta name="twitter:description" content="程序实验11&amp;12.外部中断-定时器中断 中断系统 中断概念 中断是为使单片机具有对外部或内部随机发生的事件实时处理而设置的，中断功能的存在很大程度上提高了单片机处理外部或内部事件的能力。引起程序中断的根源称为中断源。\n">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "dark");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu16835031703737007367.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🐦</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">一杯为品</a></h1>
            <h2 class="site-description">哈工大2023届智能机器人班在读，在努力成为机器人、人工智能、硬件工程多面手的路上</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://blog.csdn.net/mojin2005?spm=1010.2135.3001.5343'
                        target="_blank"
                        title="CSDN"
                        rel="me"
                    >
                        
                        
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M48 0H0V48H48V0ZM25.9509 14.1922C27.8907 14.578 29.6725 15.5304 31.0711 16.9289C31.8521 17.71 33.1184 17.71 33.8995 16.9289C34.6805 16.1479 34.6805 14.8816 33.8995 14.1005C31.9416 12.1426 29.447 10.8092 26.7313 10.269C24.0155 9.72882 21.2006 10.0061 18.6424 11.0657C16.0843 12.1253 13.8978 13.9197 12.3594 16.222C10.8211 18.5243 10 21.2311 10 24C10 26.7689 10.8211 29.4757 12.3594 31.778C13.8978 34.0803 16.0843 35.8747 18.6424 36.9343C21.2006 37.9939 24.0155 38.2712 26.7313 37.731C29.447 37.1908 31.9416 35.8574 33.8995 33.8995C34.6805 33.1185 34.6805 31.8521 33.8995 31.0711C33.1184 30.29 31.8521 30.29 31.0711 31.0711C29.6725 32.4696 27.8907 33.422 25.9509 33.8079C24.0111 34.1937 22.0004 33.9957 20.1732 33.2388C18.3459 32.4819 16.7841 31.2002 15.6853 29.5557C14.5865 27.9112 14 25.9778 14 24C14 22.0222 14.5865 20.0888 15.6853 18.4443C16.7841 16.7998 18.3459 15.5181 20.1732 14.7612C22.0004 14.0043 24.0111 13.8063 25.9509 14.1922Z" fill="#333333"/>
</svg>

                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/INKEM'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>友情链接</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#中断系统">中断系统</a>
      <ol>
        <li><a href="#中断概念">中断概念</a></li>
        <li><a href="#中断结构">中断结构</a></li>
        <li><a href="#中断寄存器">中断寄存器</a>
          <ol>
            <li><a href="#ie-寄存器">IE 寄存器</a></li>
            <li><a href="#tcon寄存器">TCON寄存器</a></li>
            <li><a href="#中断优先级">中断优先级</a></li>
            <li><a href="#中断号">中断号</a></li>
            <li><a href="#中断响应条件">中断响应条件</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#外部中断">外部中断</a>
      <ol>
        <li><a href="#硬件设计">硬件设计</a></li>
        <li><a href="#实验11-外部中断">实验11 外部中断</a></li>
      </ol>
    </li>
    <li><a href="#定时器中断">定时器中断</a>
      <ol>
        <li><a href="#定时器介绍">定时器介绍</a>
          <ol>
            <li><a href="#cpu时序">CPU时序</a></li>
            <li><a href="#定时器原理">定时器原理</a></li>
            <li><a href="#定时器结构">定时器结构</a></li>
            <li><a href="#定时器工作方式">定时器工作方式</a></li>
          </ol>
        </li>
        <li><a href="#定时器配置">定时器配置</a></li>
        <li><a href="#实验12-定时器中断">实验12 定时器中断</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="background-color: #2a9d8f; color: #fff;">
                学习笔记
            </a>
        
            <a href="/categories/51%E5%8D%95%E7%89%87%E6%9C%BA/" style="background-color: #FF0000; color: #fff;">
                51单片机
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/">【51单片机】程序实验11&amp;12.外部中断-定时器中断</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Dec 04, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 8 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="程序实验1112外部中断-定时器中断">程序实验11&amp;12.外部中断-定时器中断
</h1><h2 id="中断系统">中断系统
</h2><h3 id="中断概念">中断概念
</h3><p><strong>中断</strong>是为使单片机具有对外部或内部随机发生的事件实时处理而设置的，中断功能的存在很大程度上提高了单片机处理外部或内部事件的能力。引起程序中断的根源称为<strong>中断源</strong>。</p>
<p>单片机处理中断的过程：</p>
<img src="1.png" style="zoom:50%;" />
<p>引起CPU中断的根源称为<strong>中断源</strong>。</p>
<p>单片机的中断系统允许有多个中断源，当几个中断源同时向CPU发出中断请求时，需要解决<strong>中断优先级</strong>的问题，CPU会先执行优先级高的中断程序。单片机中对中断源有默认的优先级别，也可以通过对应的寄存器修改优先级。</p>
<p>如果CPU在执行中断源A的中断程序时发生了优先级更高的中断源B，那么CPU将转而执行B的中断程序再回到原来的位置继续执行A的中断程序，称为<strong>中断嵌套</strong>。中断嵌套在51单片机中应用很少，在STM32、DSP等中断较为复杂的单片机中经常遇到。</p>
<p>中断的优点：分时操作、实时响应、可靠性高。</p>
<h3 id="中断结构">中断结构
</h3><p>一个增强型51单片机提供了8个中断源，分别为外部中断INT0<del>3、定时器中断TIME0</del>2和一个串行口中断UART，而普通系列的51单片机均有的5个中断源为INT0、INT1、T0、T1、UART。</p>
<p><img src="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/2.png"
	width="2388"
	height="1632"
	srcset="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/2_hu1448562219152276077.png 480w, /p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/2_hu3814306964420042331.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="146"
		data-flex-basis="351px"
	
>
如图是一个中断结构，从上到下中断的优先级从高到低，左侧连接单片机管脚。在中断标志之前，外部中断需要先通过IT0、IT1选择中断触发方式，0为低电平触发，1为下降沿触发。<strong>中断标志</strong>在接收到中断后自动置为1，其中串行中断的中断标志经过一个或运算。<strong>IE寄存器</strong> 设置中断在程序中的有效与否，<strong>源允许</strong>分别控制每个中断的有效性，而<strong>总允许</strong>控制所有中断的有效性，只有中断对应的源允许和总允许都接通时才能被CPU接收。<strong>IP寄存器</strong> 部分配置中断优先级，1的优先级高于0，其余遵循默认优先级。</p>
<h3 id="中断寄存器">中断寄存器
</h3><h4 id="ie-寄存器">IE 寄存器
</h4><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>位</th>
          <th>7</th>
          <th>6</th>
          <th>5</th>
          <th>4</th>
          <th>3</th>
          <th>2</th>
          <th>1</th>
          <th>0</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>字节地址：A8H</td>
          <td>EA</td>
          <td></td>
          <td></td>
          <td>ES</td>
          <td>ET1</td>
          <td>EX1</td>
          <td>ET0</td>
          <td>EX0</td>
      </tr>
      <tr>
          <td>允许接收中断时将相应的位设为1。</td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table></div>
<h4 id="tcon寄存器">TCON寄存器
</h4><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>位</th>
          <th>7</th>
          <th>6</th>
          <th>5</th>
          <th>4</th>
          <th>3</th>
          <th>2</th>
          <th>1</th>
          <th>0</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>字节地址：88H</td>
          <td>TF1</td>
          <td>TR1</td>
          <td>TF0</td>
          <td>TR0</td>
          <td>IE1</td>
          <td>IT1</td>
          <td>IE0</td>
          <td>IT0</td>
      </tr>
      <tr>
          <td>IT0和IT1控制相应外部中断的触发方式，0为低电平触发，1为下降沿触发。TR0、TR1为定时器控制位，在定时器中断中会讲到。其余中断请求标志位皆由单片机内部自动设置。</td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table></div>
<h4 id="中断优先级">中断优先级
</h4><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>中断源</th>
          <th>中断标志</th>
          <th>中断服务程序入口</th>
          <th>优先级顺序</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>外部中断0（INT0）</td>
          <td>IE0</td>
          <td>0003H</td>
          <td>高</td>
      </tr>
      <tr>
          <td>定时/计数器0（T0）</td>
          <td>TF0</td>
          <td>000BH</td>
          <td>↓</td>
      </tr>
      <tr>
          <td>外部中断1（INT1）</td>
          <td>IE1</td>
          <td>0013H</td>
          <td>↓</td>
      </tr>
      <tr>
          <td>定时/计数器1（T1）</td>
          <td>TF1</td>
          <td>001BH</td>
          <td>↓</td>
      </tr>
      <tr>
          <td>串行口</td>
          <td>R1或T1</td>
          <td>0023H</td>
          <td>低</td>
      </tr>
  </tbody>
</table></div>
<h4 id="中断号">中断号
</h4><p>中断号在程序中指引CPU定位哪个中断并进入相应的中断服务程序。</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>中断源符号</th>
          <th>名称</th>
          <th>中断引起原因</th>
          <th>中断号</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>INT0</td>
          <td>外部中断0</td>
          <td>P3.2引脚低电平或下降沿信号</td>
          <td>0</td>
      </tr>
      <tr>
          <td>T0</td>
          <td>定时器中断0</td>
          <td>定时/计数器0计数回0溢出</td>
          <td>1</td>
      </tr>
      <tr>
          <td>INT1</td>
          <td>外部中断1</td>
          <td>P3.3引脚低电平或下降沿信号</td>
          <td>2</td>
      </tr>
      <tr>
          <td>T1</td>
          <td>定时器中断1</td>
          <td>定时/计数器1计数回0溢出</td>
          <td>3</td>
      </tr>
      <tr>
          <td>T1/R1</td>
          <td>串行口中断</td>
          <td>串行通信完成一帧数据发送或接收引起中断</td>
          <td>4</td>
      </tr>
  </tbody>
</table></div>
<h4 id="中断响应条件">中断响应条件
</h4><p>满足下面三个条件CPU才能触发中断响应：</p>
<ul>
<li>中断源有中断请求。</li>
<li>中断源的中断允许为1。</li>
<li>CPU开中断。
以外部中断0为例：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">EA</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//打开总中断开关
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">EX0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//打开外部中断0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">IT0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//设置外部中断的触发方式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">int0</span><span class="p">()</span> <span class="n">interrupt</span> <span class="mi">0</span> <span class="c1">//中断函数需要interrupt跟随中断号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//编写用户所需的功能代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="外部中断">外部中断
</h2><h3 id="硬件设计">硬件设计
</h3><p><img src="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/3.png"
	width="532"
	height="200"
	srcset="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/3_hu18278381731502185164.png 480w, /p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/3_hu15653782795142508766.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="266"
		data-flex-basis="638px"
	
></p>
<p>外部中断INT0和INT1分别为单片机管脚P32和P33的附加功能，而这两个管脚又与独立按键K3和K4连接。管脚自带上拉电阻默认为高电平，按键按下时管脚接地变为低电平，假如将外部中断配置为下降沿的触发方式则按键按下瞬间触发外部中断。</p>
<h3 id="实验11-外部中断">实验11 外部中断
</h3><p>实现功能：使用独立按键K3控制LED1亮灭。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;reg52.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">u8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">u16</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//定义按键和LED1的控制管脚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">sbit</span> <span class="n">KEY3</span> <span class="o">=</span> <span class="n">P3</span><span class="o">^</span><span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">sbit</span> <span class="n">LED1</span> <span class="o">=</span> <span class="n">P2</span><span class="o">^</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//毫秒延时函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">delay_ms</span><span class="p">(</span><span class="n">u16</span> <span class="n">ms</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">u16</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">ms</span><span class="p">;</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">110</span><span class="p">;</span><span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">--</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//外部中断0配置函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">exti0_init</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//寄存器的每一位在reg52.h头文件里均已定义
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">IT0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//设置外部中断触发方式为下降沿
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">EX0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//打开外部中断0开关
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">EA</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//打开总中断开关
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">exti0_init</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//当检测到中断，CPU会自动跳到主函数外的中断服务函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//外部中断0服务函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">exti0</span><span class="p">()</span> <span class="n">interrupt</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">delay_ms</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="c1">//消抖
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span><span class="p">(</span><span class="n">KEY3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">LED1</span> <span class="o">=</span> <span class="o">!</span><span class="n">LED1</span><span class="p">;</span> <span class="c1">//切换LED1的亮灭状态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="定时器中断">定时器中断
</h2><h3 id="定时器介绍">定时器介绍
</h3><h4 id="cpu时序">CPU时序
</h4><ul>
<li>振荡周期：为单片机提供定时信号的振荡源的周期。</li>
<li>状态周期：两个振荡周期。</li>
<li>机器周期：六个状态周期。</li>
<li>指令周期：完成一条指令占用的时间，通常为1~4个机器周期。
如果单片机的振荡频率为12MHz，则对应的机器周期为$1\mathrm{\mu s}$。</li>
</ul>
<h4 id="定时器原理">定时器原理
</h4><p>定时器的实质是一种加一计数器，随着脉冲的输入自动加一，可存储16位，分为高八位TH和低八位TL。当计数器数位全为1时，下一个脉冲将使计数器溢出，计数器归零的同时会使相应的中断标志置一。定时和计数的次数通过计数器的初值来设定，$次数=溢出值-初值$，对于较大的次数采用分段计数。</p>
<h4 id="定时器结构">定时器结构
</h4><p><img src="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/4.png"
	width="4202"
	height="2240"
	srcset="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/4_hu10115491330730548486.png 480w, /p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/4_hu13499524991632798171.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="187"
		data-flex-basis="450px"
	
></p>
<p>51单片机定时器的工作由两个特殊八位寄存器TCON和TMOD来控制。TMOD确定定时器的工作方式和功能，TCON低四位控制外部中断，高四位控制定时器的启停及溢出。</p>
<p>定时器的两个功能分别为定时功能和计数功能。定时功能接收来自CPU振荡器（OSC）的机器周期脉冲，计数功能接收来自单片机管脚P3.4和P3.5的脉冲。</p>
<h5 id="工作方式寄存器tmod">工作方式寄存器TMOD
</h5><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>位</th>
          <th>7</th>
          <th>6</th>
          <th>5</th>
          <th>4</th>
          <th>3</th>
          <th>2</th>
          <th>1</th>
          <th>0</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>字节地址：89H</td>
          <td>GATE</td>
          <td>C/$\bar{\mathrm{T}}$</td>
          <td>M1</td>
          <td>M0</td>
          <td>GATE</td>
          <td>C/$\bar{\mathrm{T}}$</td>
          <td>M1</td>
          <td>M0</td>
      </tr>
      <tr>
          <td>低四位控制T0，高四位控制T1。</td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table></div>
<ul>
<li>GATE：门控位，控制定时器启动是否受外部中断影响。当GATE=0，只需通过寄存器TCON的TR0/TR1=1来使对应定时器启动；当GATE=1，在前面的基础上还需要来自外部中断引脚INT0/INT1的高电平才能启动。</li>
<li>C/$\bar{\mathrm{T}}$：定时/计数模式选择位，定时器模式设为0，计数器模式设为1。</li>
<li>M1&amp;M0：工作方式选择位，见下表：</li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>M1M0</th>
          <th>工作方式</th>
          <th>说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>00</td>
          <td>方式0</td>
          <td>13位定时/计数器</td>
      </tr>
      <tr>
          <td>01</td>
          <td>方式1</td>
          <td>16位定时/计数器</td>
      </tr>
      <tr>
          <td>10</td>
          <td>方式2</td>
          <td>8位自动重装定时/计数器</td>
      </tr>
      <tr>
          <td>11</td>
          <td>方式3</td>
          <td>T0分成两个独立的8位定时/计数器；T1此方式停止计数</td>
      </tr>
      <tr>
          <td>我们常用的为方式1和方式2，方式1用于定时/计数器工作，方式2用于串口通信波特率的生成，将在下一个实验涉及。</td>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table></div>
<h5 id="控制寄存器tcon">控制寄存器TCON
</h5><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>位</th>
          <th>7</th>
          <th>6</th>
          <th>5</th>
          <th>4</th>
          <th>3</th>
          <th>2</th>
          <th>1</th>
          <th>0</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>字节地址：88H</td>
          <td>TF1</td>
          <td>TR1</td>
          <td>TF0</td>
          <td>TR0</td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>TF0/TF1：定时器溢出中断请求标志，由硬件自动完成，可通过调用查询定时器溢出状态。</td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table></div>
<p>TR0/TR1：定时器的运行控制位，设置为1时定时器开始工作，设置为0时定时器停止工作。</p>
<h4 id="定时器工作方式">定时器工作方式
</h4><h5 id="方式0">方式0
</h5><p><img src="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/5.png"
	width="1327"
	height="546"
	srcset="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/5_hu495858458329219162.png 480w, /p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/5_hu14754337942695898036.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="243"
		data-flex-basis="583px"
	
>
13位定时/计数器用到TH的八位和TL的低五位。</p>
<p>GATE控制原理：GATE经过一个非门后和INT引脚进行或门运算，若GATE=0，非门后为1，无论INT引脚为0还是1，或运算结果都为1；若GATE=1，非门后为0，只有INT引脚为1，或运算结果才为1。随后再和TR运行控制位进行与运算，当TR=1且或运算结果为1时定时器启动。</p>
<p>C/$\bar{\mathrm{T}}$控制原理：当C/$\bar{\mathrm{T}}$=1，虚线对应开关打到1，定时器接收T0引脚的脉冲；当C/$\bar{\mathrm{T}}$=0，开关打到0，定时器接收机器周期脉冲。</p>
<h5 id="方式1">方式1
</h5><p><img src="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/6.png"
	width="1349"
	height="555"
	srcset="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/6_hu4210163599276574787.png 480w, /p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/6_hu1422570499281232324.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="243"
		data-flex-basis="583px"
	
></p>
<p>方式1与方式0的区别为定时器TH的八位和TL的八位都参与计数。</p>
<h5 id="方式2">方式2
</h5><p><img src="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/7.png"
	width="1502"
	height="614"
	srcset="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/7_hu11983990120303024256.png 480w, /p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/7_hu2007363413840603664.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="244"
		data-flex-basis="587px"
	
></p>
<p>方式2中用TL进行计数，TH进行装载。当TL溢出时，TH会自动将设置好的值装载进TL重新开始计数，适用于精确的脉冲信号发生器，例如串口通信。</p>
<h5 id="方式3">方式3
</h5><p><img src="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/8.png"
	width="1354"
	height="626"
	srcset="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/8_hu11815828650776990081.png 480w, /p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C1112.%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%AD%E6%96%AD/8_hu10816591118661854700.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="216"
		data-flex-basis="519px"
	
></p>
<p>方式3只适用于T0，此时T1停止工作。其中TL0可用于定时和计数，与中断标志TF0连接；TH0仅用于定时，与中断标志TF1连接。</p>
<h3 id="定时器配置">定时器配置
</h3><ul>
<li>对TMOD赋值以确定T0和T1的工作方式。</li>
<li>根据所要定时的时间计算初值并写入TH0、TL0或TH1、TL1。</li>
<li>如果使用中断，则对EA赋值并开放定时器中断。</li>
<li>设置TR0或TR1为1，启动定时/计数器定时或计数。
对于初值的计算，可使用相关软件。下图中，方式1溢出值为$2^{16}=65536$，减去1ms对应的机器周期数1000，将结果64536转化为十六进制，FC对应高八位写入TH，18对应低八位写入TL。</li>
</ul>
<img src="9.png" style="zoom:67%;" />
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">//以定时器0的配置为例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">time0_init</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">TMOD</span> <span class="o">|=</span> <span class="mh">0x01</span><span class="p">;</span> <span class="c1">//选择为定时器0模式，工作方式1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">TH0</span> <span class="o">=</span> <span class="mh">0xFC</span><span class="p">;</span> <span class="c1">//给定时器赋初值，定时1ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">TL0</span> <span class="o">=</span> <span class="mh">0x18</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">ET0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//打开定时器0中断允许
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">EA</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//打开总中断
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">TR0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//打开定时器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中TMOD使用了或运算是为了不干扰高四位对定时器1的配置，赋值符号右侧将高四位都设为0不会改变原有高四位的值，如果配置定时器1则将低四位都设为0。</p>
<h3 id="实验12-定时器中断">实验12 定时器中断
</h3><p>实现功能：通过定时器0中断控制D1指示灯隔1秒闪烁。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;reg52.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">u8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">u16</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//定义LED1的控制管脚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">sbit</span> <span class="n">LED1</span> <span class="o">=</span> <span class="n">P2</span><span class="o">^</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//定时器0初始化函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">time0_init</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">TMOD</span> <span class="o">|=</span> <span class="mh">0x01</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">TH0</span> <span class="o">=</span> <span class="mh">0xFC</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">TL0</span> <span class="o">=</span> <span class="mh">0x66</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">ET0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">EA</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">TR0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">time0_init</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//定时器0中断服务函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">time0</span><span class="p">()</span> <span class="n">interrupt</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//静态变量i累计毫秒值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">static</span> <span class="n">u16</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//触发中断后将定时器重置为初值，使其立即重新计时
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">TH0</span> <span class="o">=</span> <span class="mh">0xFC</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">TL0</span> <span class="o">=</span> <span class="mh">0x66</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//毫秒值累加
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//如果达到1秒
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//重新累计毫秒值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">LED1</span> <span class="o">=</span> <span class="o">!</span><span class="n">LED1</span><span class="p">;</span> <span class="c1">//切换LED1亮灭状态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>本篇完</strong></p>

</section>


    <footer class="article-footer">
    

    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C910.%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BA-%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/">
        
        

        <div class="article-details">
            <h2 class="article-title">【51单片机】程序实验9&amp;10.直流电机-步进电机</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C78.io%E6%89%A9%E5%B1%95-led%E7%82%B9%E9%98%B5/">
        
        

        <div class="article-details">
            <h2 class="article-title">【51单片机】程序实验7&amp;8.IO扩展-LED点阵</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C56.%E7%8B%AC%E7%AB%8B%E6%8C%89%E9%94%AE-%E7%9F%A9%E9%98%B5%E6%8C%89%E9%94%AE/">
        
        

        <div class="article-details">
            <h2 class="article-title">【51单片机】程序实验5&amp;6.独立按键-矩阵按键</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8C2~4.%E8%9C%82%E9%B8%A3%E5%99%A8-%E9%9D%99%E6%80%81%E6%95%B0%E7%A0%81%E7%AE%A1-%E5%8A%A8%E6%80%81%E6%95%B0%E7%A0%81%E7%AE%A1/">
        
        

        <div class="article-details">
            <h2 class="article-title">【51单片机】程序实验2~4.蜂鸣器-静态数码管-动态数码管</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%A8%8B%E5%BA%8F%E5%AE%9E%E9%AA%8Cep1.%E7%82%B9%E4%BA%AEled/">
        
        

        <div class="article-details">
            <h2 class="article-title">【51单片机】程序实验Ep1.点亮LED</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2024 一杯为品
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
<script src=https://INKEM.github.io/background/sakura.js></script>
<style>
  body {
    background: url(https://INKEM.github.io/background/Sakura.png) no-repeat center top;
    background-size: cover;
    background-attachment: fixed;
  }
</style>
<style>
  @font-face {
    font-family: '初夏明朝';
    src: url(https://INKEM.github.io/font/EarlySummerSerif-VF.ttf) format('truetype');
  }

  :root {
    --base-font-family: '初夏明朝';
    --code-font-family: '初夏明朝';
  }
</style>

    </body>
</html>
